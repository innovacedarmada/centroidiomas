<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Places in Town Vocabulary:Drag & Drop</title>
  <style>
    :root{
      --bg:#f7fafc;
      --card:#ffffff;
      --accent:#2563eb;
      --correct:#58cc02;
      --incorrect:#ea2b2b;
      --border:#e5e7eb;
    }
    body{font-family:'Segoe UI',sans-serif;margin:0;background:var(--bg);color:#111}
    .wrap{max-width:800px;margin:0 auto;padding:20px;min-height:100vh;display:flex;flex-direction:column;}
    
    header{display:flex;align-items:center;padding:10px 0;}
    .progress-container{flex-grow:1;height:12px;background:var(--border);border-radius:6px;overflow:hidden;margin-left:20px;}
    .progress-fill{height:100%;width:0%;background:var(--correct);border-radius:6px;transition:width 0.3s ease-in-out;}
    
    main{flex-grow:1;padding:20px 0;}
    h1{font-size:28px;font-weight:700;color:var(--accent);margin-top:0;}
    h3{margin-top:0;font-size:18px;font-weight:600;margin-bottom:15px;color:#333;}
    /* Only the active slide is shown */
    .slide{display:none;padding-bottom:60px;border-bottom:1px solid var(--border);margin-bottom:20px;}
    .slide.active{display:block;}

    .question-row{margin-bottom:30px;padding:15px;border:1px solid var(--border);border-radius:8px;background:var(--card);}
    .sentence-text{font-size:16px;line-height:1.8;font-weight:500;}

    /* Drag & Drop Styles */
    .word-bank{
      display:flex;flex-wrap:wrap;gap:8px;margin-top:20px;
      padding:15px;border:1px solid #ccc;border-radius:8px;background:#f0f0f0;
      min-height: 50px;
    }
    .draggable-word{
      background-color:var(--accent);color:white;padding:8px 15px;
      border-radius:20px;cursor:grab;user-select:none;font-weight:600;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background-color 0.2s;
      border: 2px solid var(--accent);
    }
    .draggable-word:active{cursor:grabbing;}
    
    .drop-zone{
      display: inline-flex;
      min-width: 150px;
      min-height: 38px;
      border: 2px dashed #999;
      background-color:#eef2ff;
      padding: 5px;
      border-radius: 6px;
      align-items: center;
      justify-content: center;
      margin: 0 5px;
      vertical-align: middle;
    }
    .drop-zone.correct-drop .draggable-word{background-color:var(--correct);border-color:var(--correct);}
    .drop-zone.incorrect-drop .draggable-word{background-color:var(--incorrect);border-color:var(--incorrect);}

    .controls-panel{
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: white;
      border-top: 1px solid var(--border);
      padding: 10px 0;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
      z-index: 10;
    }
    .controls-inner{
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 0 20px;
    }

    .check-btn{
      background:var(--accent);color:white;border:none;
      padding:10px 20px;border-radius:10px;font-weight:700;cursor:pointer;
      font-size: 16px;
      transition:background 0.2s;
    }
    .check-btn:disabled{background:#ccc;cursor:not-allowed;}
    .check-btn.next-btn{background:var(--correct);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="font-size:24px;font-weight:bold;">üìç Vocabulary Quiz</div>
      <div class="progress-container"><div class="progress-fill" id="progress-fill"></div></div>
    </header>

    <main>
      <h1>Places in Town (A2)</h1>

      <div class="slide active" id="slide1">
        <h3>Drag the word to the correct blank. (1/4)</h3>
        
        <div class="word-bank" id="word-bank-1">
          <span class="draggable-word" draggable="true" data-word="cinema">Cinema</span>
          <span class="draggable-word" draggable="true" data-word="bakery">Bakery</span>
          <span class="draggable-word" draggable="true" data-word="hospital">Hospital</span>
          <span class="draggable-word" draggable="true" data-word="bank">Bank</span>
          <span class="draggable-word" draggable="true" data-word="library">Library</span>
        </div>

        <div class="question-row" data-answer="cinema">
          <div class="sentence-text">1. We are going to watch the new sci-fi movie at the <span class="drop-zone" ondrop="drop(event, 'q1')" ondragover="allowDrop(event)" id="q1"></span> tonight.</div>
        </div>

        <div class="question-row" data-answer="bakery">
          <div class="sentence-text">2. I bought a fresh loaf of bread and a croissant at the <span class="drop-zone" ondrop="drop(event, 'q2')" ondragover="allowDrop(event)" id="q2"></span> this morning.</div>
        </div>

        <div class="question-row" data-answer="hospital">
          <div class="sentence-text">3. If you have an emergency, the closest <span class="drop-zone" ondrop="drop(event, 'q3')" ondragover="allowDrop(event)" id="q3"></span> is just around the corner.</div>
        </div>

        <div class="question-row" data-answer="bank">
          <div class="sentence-text">4. I need to deposit a check and withdraw some cash from the <span class="drop-zone" ondrop="drop(event, 'q4')" ondragover="allowDrop(event)" id="q4"></span>.</div>
        </div>

        <div class="question-row" data-answer="library">
          <div class="sentence-text">5. I study and borrow books at the public <span class="drop-zone" ondrop="drop(event, 'q5')" ondragover="allowDrop(event)" id="q5"></span> every Tuesday.</div>
        </div>
      </div>

      <div class="slide" id="slide2">
        <h3>Drag the word to the correct blank. (2/4)</h3>
        
        <div class="word-bank" id="word-bank-2">
          <span class="draggable-word" draggable="true" data-word="museum">Museum</span>
          <span class="draggable-word" draggable="true" data-word="post office">Post Office</span>
          <span class="draggable-word" draggable="true" data-word="supermarket">Supermarket</span>
          <span class="draggable-word" draggable="true" data-word="hotel">Hotel</span>
          <span class="draggable-word" draggable="true" data-word="restaurant">Restaurant</span>
        </div>

        <div class="question-row" data-answer="museum">
          <div class="sentence-text">6. Next weekend, we plan to see the new dinosaur exhibition at the city <span class="drop-zone" ondrop="drop(event, 'q6')" ondragover="allowDrop(event)" id="q6"></span>.</div>
        </div>

        <div class="question-row" data-answer="supermarket">
          <div class="sentence-text">7. She went to the <span class="drop-zone" ondrop="drop(event, 'q7')" ondragover="allowDrop(event)" id="q7"></span> to buy groceries for the week.</div>
        </div>

        <div class="question-row" data-answer="post office">
          <div class="sentence-text">8. You can mail letters and packages at the <span class="drop-zone" ondrop="drop(event, 'q8')" ondragover="allowDrop(event)" id="q8"></span>.</div>
        </div>

        <div class="question-row" data-answer="hotel">
          <div class="sentence-text">9. We are staying for three nights at the luxury <span class="drop-zone" ondrop="drop(event, 'q9')" ondragover="allowDrop(event)" id="q9"></span> near the beach.</div>
        </div>

        <div class="question-row" data-answer="restaurant">
          <div class="sentence-text">10. Let's eat a nice dinner at the Italian <span class="drop-zone" ondrop="drop(event, 'q10')" ondragover="allowDrop(event)" id="q10"></span> tonight.</div>
        </div>
      </div>

      <div class="slide" id="slide3">
        <h3>Drag the word to the correct blank. (3/4)</h3>
        
        <div class="word-bank" id="word-bank-3">
          <span class="draggable-word" draggable="true" data-word="police station">Police Station</span>
          <span class="draggable-word" draggable="true" data-word="church">Church</span>
          <span class="draggable-word" draggable="true" data-word="school">School</span>
          <span class="draggable-word" draggable="true" data-word="shopping mall">Shopping Mall</span>
          <span class="draggable-word" draggable="true" data-word="park">Park</span>
        </div>

        <div class="question-row" data-answer="police station">
          <div class="sentence-text">11. If you see a crime, you should report it immediately to the <span class="drop-zone" ondrop="drop(event, 'q11')" ondragover="allowDrop(event)" id="q11"></span>.</div>
        </div>

        <div class="question-row" data-answer="church">
          <div class="sentence-text">12. On Sundays, our family goes to the <span class="drop-zone" ondrop="drop(event, 'q12')" ondragover="allowDrop(event)" id="q12"></span> for a religious service.</div>
        </div>

        <div class="question-row" data-answer="school">
          <div class="sentence-text">13. Children usually go to <span class="drop-zone" ondrop="drop(event, 'q13')" ondragover="allowDrop(event)" id="q13"></span> from Monday to Friday.</div>
        </div>

        <div class="question-row" data-answer="shopping mall">
          <div class="sentence-text">14. We spent the whole afternoon browsing the shops at the huge <span class="drop-zone" ondrop="drop(event, 'q14')" ondragover="allowDrop(event)" id="q14"></span>.</div>
        </div>
        
        <div class="question-row" data-answer="park">
          <div class="sentence-text">15. I like to walk my dog and have a picnic in the large <span class="drop-zone" ondrop="drop(event, 'q15')" ondragover="allowDrop(event)" id="q15"></span> near my apartment.</div>
        </div>
      </div>

      <div class="slide" id="slide4">
        <h3>Drag the word to the correct blank. (4/4)</h3>
        
        <div class="word-bank" id="word-bank-4">
          <span class="draggable-word" draggable="true" data-word="zoo">Zoo</span>
          <span class="draggable-word" draggable="true" data-word="train station">Train Station</span>
          <span class="draggable-word" draggable="true" data-word="bus station">Bus Station</span>
          <span class="draggable-word" draggable="true" data-word="fire station">Fire Station</span>
          <span class="draggable-word" draggable="true" data-word="pharmacy">Pharmacy</span>
        </div>

        <div class="question-row" data-answer="zoo">
          <div class="sentence-text">16. We took the kids to the <span class="drop-zone" ondrop="drop(event, 'q16')" ondragover="allowDrop(event)" id="q16"></span> to see the elephants and giraffes.</div>
        </div>

        <div class="question-row" data-answer="train station">
          <div class="sentence-text">17. You can catch the express line to the city from the <span class="drop-zone" ondrop="drop(event, 'q17')" ondragover="allowDrop(event)" id="q17"></span>.</div>
        </div>

        <div class="question-row" data-answer="bus station">
          <div class="sentence-text">18. Where can I buy a ticket for the bus to Paris? At the <span class="drop-zone" ondrop="drop(event, 'q18')" ondragover="allowDrop(event)" id="q18"></span>.</div>
        </div>
        
        <div class="question-row" data-answer="pharmacy">
          <div class="sentence-text">19. I need to get a prescription filled and buy some cold medicine at the <span class="drop-zone" ondrop="drop(event, 'q19')" ondragover="allowDrop(event)" id="q19"></span>.</div>
        </div>
        
        <div class="question-row" data-answer="fire station">
          <div class="sentence-text">20. If there is a fire, you need to call the <span class="drop-zone" ondrop="drop(event, 'q20')" ondragover="allowDrop(event)" id="q20"></span> immediately.</div>
        </div>

      </div>

    </main>

    <div class="controls-panel">
      <div class="controls-inner">
        <button class="check-btn" id="main-check-btn" onclick="checkSlideAnswers(currentSlide)">Check Answers</button>
      </div>
    </div>
  </div>

<script>
let currentSlide = 1;
const totalSlides = 4;
const totalQuestions = 20;
let correctAnswersCount = 0;
// Map to hold the question range for each slide (5 Qs per slide)
const slideQuestionMap = {1: [1, 5], 2: [6, 10], 3: [11, 15], 4: [16, 20]}; 

// Fisher-Yates (Knuth) Shuffle Algorithm
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        // Swap elements i and j
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// Initial setup to give words unique IDs for dragging
window.onload = () => {
  document.querySelectorAll('.draggable-word').forEach(w => {
    if (!w.id) w.id = `drag-${Math.random().toString(36).substr(2, 9)}`;
    w.addEventListener('dragstart', drag);
  });
  // Shuffle all word banks initially
  for (let i = 1; i <= totalSlides; i++) {
    const wordBank = document.getElementById(`word-bank-${i}`);
    const children = Array.from(wordBank.children);
    shuffleArray(children);
    children.forEach(child => wordBank.appendChild(child));
  }

  showSlide(currentSlide);
  updateProgress();
};

/* --- Drag & Drop Functions --- */
function allowDrop(e) { e.preventDefault(); }
function drag(e) { e.dataTransfer.setData("text", e.target.id); }

function drop(e, qId) { 
  e.preventDefault(); 
  const data = e.dataTransfer.getData("text");
  const draggedElement = document.getElementById(data);
  const targetDropZone = document.getElementById(qId);
  
  // Find the correct word bank for the current slide
  const wordBankId = `word-bank-${currentSlide}`;
  const wordBank = document.getElementById(wordBankId);

  // If there's already a word in the drop zone, move it back to the word bank
  if (targetDropZone.children.length > 0) {
    const wordToMoveBack = targetDropZone.children[0];
    wordBank.appendChild(wordToMoveBack);
    // Remove correctness styling
    wordToMoveBack.parentElement.classList.remove('correct-drop', 'incorrect-drop');
  }

  // Move the new word into the drop zone
  targetDropZone.appendChild(draggedElement);
  
  // Re-enable the check button and reset text/color
  const checkBtn = document.getElementById('main-check-btn');
  checkBtn.disabled = false;
  checkBtn.textContent = "Check Answers";
  checkBtn.classList.remove('next-btn');
  checkBtn.style.background = "var(--accent)";
}
/* ----------------------------- */

function updateProgress() {
  document.getElementById('progress-fill').style.width = `${(correctAnswersCount / totalQuestions) * 100}%`;
}

function showSlide(n) {
  document.querySelectorAll('.slide').forEach(slide => slide.classList.remove('active'));
  document.getElementById(`slide${n}`).classList.add('active');
  
  const checkBtn = document.getElementById('main-check-btn');
  checkBtn.textContent = "Check Answers";
  checkBtn.classList.remove('next-btn');
  checkBtn.style.background = "var(--accent)";
  checkBtn.disabled = false;
  checkBtn.onclick = () => checkSlideAnswers(currentSlide);

  // Check if all questions on this slide are already marked correct
  const [startQ, endQ] = slideQuestionMap[n];
  let allCorrect = true;
  for(let i = startQ; i <= endQ; i++) {
    const dropZone = document.getElementById(`q${i}`);
    if (!dropZone || !dropZone.classList.contains('correct-drop')) {
      allCorrect = false;
      break;
    }
  }

  if (allCorrect) {
    if (n < totalSlides) {
      checkBtn.textContent = "Next Slide >>";
      checkBtn.classList.add('next-btn');
      checkBtn.style.background = "var(--correct)";
      checkBtn.onclick = nextSlide;
    } else {
       checkBtn.textContent = "Finished! üéâ";
       checkBtn.classList.add('next-btn');
       checkBtn.style.background = "var(--correct)";
       checkBtn.disabled = true;
       alert("üéâ You finished the Places in Town Vocabulary Quiz!");
    }
  }
}

function nextSlide() {
  currentSlide++;
  if (currentSlide <= totalSlides) {
    showSlide(currentSlide);
  }
}

function checkSlideAnswers(slideNumber) {
  let slideCorrectCount = 0;
  const [startQ, endQ] = slideQuestionMap[slideNumber];
  let totalInSlide = endQ - startQ + 1;
  let newCorrectInSlide = 0; // Tracks new correct answers for progress bar

  for (let i = startQ; i <= endQ; i++) {
    const dropZone = document.getElementById(`q${i}`);
    const questionRow = dropZone.closest('.question-row');
    const correctAnswer = questionRow.dataset.answer.toLowerCase().trim();
    
    // Check if question was already correct
    const wasCorrect = dropZone.classList.contains('correct-drop');

    if (wasCorrect) {
      slideCorrectCount++;
      continue;
    }
    
    // Check the current submission
    if (dropZone.children.length > 0) {
      const submittedAnswer = dropZone.children[0].dataset.word.toLowerCase().trim();
      
      dropZone.classList.remove('incorrect-drop');
      
      if (submittedAnswer === correctAnswer) {
        dropZone.classList.add('correct-drop');
        slideCorrectCount++;
        newCorrectInSlide++;
      } else {
        dropZone.classList.add('incorrect-drop');
      }
    } else {
      // If blank
      dropZone.classList.remove('correct-drop');
      dropZone.classList.add('incorrect-drop');
    }
  }

  // Update global count by adding only the newly correct answers
  correctAnswersCount += newCorrectInSlide;
  updateProgress();

  const checkBtn = document.getElementById('main-check-btn');

  if (slideCorrectCount === totalInSlide) {
    checkBtn.textContent = (slideNumber < totalSlides) ? "Next Slide >>" : "Finished! üéâ";
    checkBtn.classList.add('next-btn');
    checkBtn.style.background = "var(--correct)";
    checkBtn.onclick = (slideNumber < totalSlides) ? nextSlide : () => alert("üéâ You finished the Places in Town Vocabulary Quiz!");
    if (slideNumber === totalSlides) checkBtn.disabled = true;
  } else {
    checkBtn.textContent = "Try Again";
    checkBtn.style.background = "var(--incorrect)";
    checkBtn.disabled = true; // Disable briefly to prevent spamming
    setTimeout(() => {
        if (!checkBtn.classList.contains('next-btn') && !checkBtn.disabled) {
            checkBtn.disabled = false;
            checkBtn.style.background = "var(--accent)";
            checkBtn.textContent = "Check Answers";
        }
    }, 1500); 
  }
}

</script>

</body>
</html>